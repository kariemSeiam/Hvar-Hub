<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>HVAR Hub | ŸÖÿ±ŸÉÿ≤ ŸáŸÅÿßÿ±</title>
    <meta name="title" content="HVAR Hub | ŸÖÿ±ŸÉÿ≤ ŸáŸÅÿßÿ±" />
    <meta name="description" content="ŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÇÿØŸÖ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ≠ ŸàÿßŸÑŸÅÿ≠ÿµ ŸÅŸä ÿßŸÑŸÖÿ±ÿßŸÉÿ≤. Ÿàÿßÿ¨Ÿáÿ© ÿπÿ±ÿ®Ÿäÿ© ÿ≠ÿØŸäÿ´ÿ© ŸÖÿπ ÿØÿπŸÖ ŸÉÿßŸÖŸÑ ŸÑŸÑŸÄ RTL." />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://hvar-hub.com/" />
    <meta property="og:title" content="HVAR Hub | ŸÖÿ±ŸÉÿ≤ ŸáŸÅÿßÿ±" />
    <meta property="og:description" content="ŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÇÿØŸÖ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ≠ ŸàÿßŸÑŸÅÿ≠ÿµ ŸÅŸä ÿßŸÑŸÖÿ±ÿßŸÉÿ≤. Ÿàÿßÿ¨Ÿáÿ© ÿπÿ±ÿ®Ÿäÿ© ÿ≠ÿØŸäÿ´ÿ© ŸÖÿπ ÿØÿπŸÖ ŸÉÿßŸÖŸÑ ŸÑŸÑŸÄ RTL." />
    <meta property="og:image" content="https://hvar-hub.com/preview.png" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://hvar-hub.com/" />
    <meta property="twitter:title" content="HVAR Hub | ŸÖÿ±ŸÉÿ≤ ŸáŸÅÿßÿ±" />
    <meta property="twitter:description" content="ŸÜÿ∏ÿßŸÖ ŸÖÿ™ŸÇÿØŸÖ ŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ≠ ŸàÿßŸÑŸÅÿ≠ÿµ ŸÅŸä ÿßŸÑŸÖÿ±ÿßŸÉÿ≤. Ÿàÿßÿ¨Ÿáÿ© ÿπÿ±ÿ®Ÿäÿ© ÿ≠ÿØŸäÿ´ÿ© ŸÖÿπ ÿØÿπŸÖ ŸÉÿßŸÖŸÑ ŸÑŸÑŸÄ RTL." />
    <meta property="twitter:image" content="https://hvar-hub.com/preview.png" />

    <!-- Additional SEO Controls (disable indexing) -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet" />
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="Arabic" />
    <meta name="author" content="HVAR Team" />

    <!-- Application Meta Tags -->
    <meta name="application-name" content="HVAR Hub" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="HVAR Hub" />

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/icon.svg" />
    <link rel="mask-icon" href="/icon.svg" color="#F43F5E" />
    
    <!-- PWA Installation Prompt -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="HVAR Hub" />
    
    <!-- MASTERPIECE CAMERA PERMISSIONS - Universal Device Support -->
    <!-- Primary Camera Meta Tags -->
    <meta name="camera" content="required" />
    <meta name="microphone" content="optional" />
    
    <!-- iOS Safari Specific -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-touch-fullscreen" content="yes" />
    
    <!-- Android Chrome Specific -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="screen-orientation" content="portrait" />
    
    <!-- Camera API Support Declarations -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    
    <!-- Modern Browser Camera Support -->
    <meta http-equiv="Feature-Policy" content="camera 'self'; microphone 'self'" />
    <meta http-equiv="Permissions-Policy" content="camera=self, microphone=self" />
    
    <!-- Legacy Support -->
    <meta name="HandheldFriendly" content="true" />
    <meta name="MobileOptimized" content="320" />
    
    <!-- WebRTC and MediaDevices Support -->
    <meta name="webrtc" content="enabled" />
    <meta name="getUserMedia" content="enabled" />
    
    <!-- Cross-Origin Camera Access -->
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp" />
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />

    <!-- Theme Color -->
    <meta name="theme-color" content="#F43F5E" />
    <meta name="msapplication-TileColor" content="#F43F5E" />

    <!-- Fonts - Optimized for Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cairo+Play:wght@300;400;500;600;700;800&family=Cairo:wght@200;300;400;500;600;700;800;900&family=Tajawal:wght@200;300;400;500;700;800;900&family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    

    <script>
      (function() {
        'use strict';
        
        console.log('üöÄ HVAR Camera Initializing...');
        
        // Device Detection
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        const isChrome = /Chrome/i.test(navigator.userAgent);
        const isFirefox = /Firefox/i.test(navigator.userAgent);
        const isEdge = /Edge/i.test(navigator.userAgent);
        const isSamsungBrowser = /SamsungBrowser/i.test(navigator.userAgent);
        
        // Browser Version Detection
        const getIOSVersion = () => {
          const match = navigator.userAgent.match(/OS (\d+)_(\d+)/);
          return match ? parseFloat(match[1] + '.' + match[2]) : 0;
        };
        
        const getAndroidVersion = () => {
          const match = navigator.userAgent.match(/Android (\d+\.?\d*)/);
          return match ? parseFloat(match[1]) : 0;
        };
        
        const getChromeVersion = () => {
          const match = navigator.userAgent.match(/Chrome\/(\d+)/);
          return match ? parseInt(match[1]) : 0;
        };
        
        const deviceInfo = {
          isMobile,
          isIOS,
          isAndroid,
          isSafari,
          isChrome,
          isFirefox,
          isEdge,
          isSamsungBrowser,
          iosVersion: isIOS ? getIOSVersion() : 0,
          androidVersion: isAndroid ? getAndroidVersion() : 0,
          chromeVersion: isChrome ? getChromeVersion() : 0
        };
        
        console.log('üì± Device Info:', deviceInfo);
        
        // Global Camera State
        window.HVARCameraState = {
          isInitialized: false,
          hasPermission: false,
          stream: null,
          error: null,
          devices: [],
          constraints: null
        };
        
        // Universal Permission Request Function
        window.HVARRequestCameraPermission = async function() {
          console.log('üé¨ Requesting camera permission...');
          
          try {
            // Method 1: Modern getUserMedia with optimal constraints
            const constraints = getOptimalConstraints();
            console.log('üìã Using constraints:', constraints);
            
            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            
            if (stream) {
              console.log('‚úÖ Camera permission granted!');
              window.HVARCameraState.hasPermission = true;
              window.HVARCameraState.stream = stream;
              window.HVARCameraState.constraints = constraints;
              
              // Get available devices
              try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                window.HVARCameraState.devices = devices.filter(device => device.kind === 'videoinput');
                console.log('üìπ Available cameras:', window.HVARCameraState.devices.length);
              } catch (e) {
                console.warn('‚ö†Ô∏è Could not enumerate devices:', e);
              }
              
              return { success: true, stream, constraints };
            }
            
          } catch (error) {
            console.error('‚ùå Camera permission error:', error);
            window.HVARCameraState.error = error;
            
            // Try fallback methods
            return await tryFallbackMethods(error);
          }
        };
        
        // Get Optimal Constraints for Device
        function getOptimalConstraints() {
          let constraints = { video: true, audio: false };
          
          // iOS Specific Optimizations
          if (isIOS) {
            constraints.video = {
              facingMode: 'environment',
              width: { ideal: 1280, min: 640, max: 1920 },
              height: { ideal: 720, min: 480, max: 1080 },
              frameRate: { ideal: 30, min: 15, max: 60 }
            };
            
            // iOS 14+ specific
            if (deviceInfo.iosVersion >= 14) {
              constraints.video.advanced = [
                { focusMode: 'continuous' },
                { exposureMode: 'continuous' },
                { whiteBalanceMode: 'continuous' }
              ];
            }
            
            // iOS 15+ enhanced features
            if (deviceInfo.iosVersion >= 15) {
              constraints.video.torch = false;
              constraints.video.zoom = { ideal: 1 };
            }
          }
          
          // Android Specific Optimizations
          else if (isAndroid) {
            constraints.video = {
              facingMode: { ideal: 'environment' },
              width: { ideal: 1280, min: 640, max: 1920 },
              height: { ideal: 720, min: 480, max: 1080 },
              frameRate: { ideal: 30, min: 20, max: 60 }
            };
            
            // Android 10+ specific
            if (deviceInfo.androidVersion >= 10) {
              constraints.video.advanced = [
                { focusMode: 'continuous' },
                { exposureMode: 'continuous' }
              ];
            }
            
            // Samsung Browser optimizations
            if (isSamsungBrowser) {
              constraints.video.frameRate = { ideal: 25, min: 15, max: 30 };
            }
          }
          
          // Desktop Browser Optimizations
          else {
            constraints.video = {
              facingMode: 'environment',
              width: { ideal: 1920, min: 1280, max: 3840 },
              height: { ideal: 1080, min: 720, max: 2160 },
              frameRate: { ideal: 60, min: 30, max: 120 }
            };
            
            // Chrome specific
            if (isChrome && deviceInfo.chromeVersion >= 90) {
              constraints.video.advanced = [
                { focusMode: 'continuous' },
                { exposureMode: 'continuous' },
                { whiteBalanceMode: 'continuous' },
                { torch: false }
              ];
            }
          }
          
          return constraints;
        }
        
        // Fallback Methods for Maximum Compatibility
        async function tryFallbackMethods(originalError) {
          console.log('üîÑ Trying fallback methods...');
          
          const fallbacks = [
            // Fallback 1: Simple video only
            { video: true },
            
            // Fallback 2: Basic constraints
            { 
              video: { 
                facingMode: 'environment',
                width: 640,
                height: 480
              }
            },
            
            // Fallback 3: No facing mode
            { 
              video: { 
                width: { ideal: 640 },
                height: { ideal: 480 }
              }
            },
            
            // Fallback 4: Minimal constraints
            { 
              video: { 
                width: 320,
                height: 240
              }
            },
            
            // Fallback 5: Any video
            { video: {} }
          ];
          
          for (let i = 0; i < fallbacks.length; i++) {
            try {
              console.log(`üîÑ Trying fallback ${i + 1}:`, fallbacks[i]);
              const stream = await navigator.mediaDevices.getUserMedia(fallbacks[i]);
              
              if (stream) {
                console.log(`‚úÖ Fallback ${i + 1} successful!`);
                window.HVARCameraState.hasPermission = true;
                window.HVARCameraState.stream = stream;
                window.HVARCameraState.constraints = fallbacks[i];
                return { success: true, stream, constraints: fallbacks[i], fallback: i + 1 };
              }
            } catch (e) {
              console.warn(`‚ö†Ô∏è Fallback ${i + 1} failed:`, e);
            }
          }
          
          // Ultimate fallback: Legacy API
          try {
            console.log('üîÑ Trying legacy getUserMedia...');
            const legacyGetUserMedia = navigator.getUserMedia || 
                                     navigator.webkitGetUserMedia || 
                                     navigator.mozGetUserMedia || 
                                     navigator.msGetUserMedia;
            
            if (legacyGetUserMedia) {
              return new Promise((resolve) => {
                legacyGetUserMedia.call(navigator, 
                  { video: true }, 
                  (stream) => {
                    console.log('‚úÖ Legacy getUserMedia successful!');
                    window.HVARCameraState.hasPermission = true;
                    window.HVARCameraState.stream = stream;
                    resolve({ success: true, stream, legacy: true });
                  },
                  (error) => {
                    console.error('‚ùå Legacy getUserMedia failed:', error);
                    resolve({ success: false, error: originalError });
                  }
                );
              });
            }
          } catch (e) {
            console.error('‚ùå Legacy fallback failed:', e);
          }
          
          return { success: false, error: originalError };
        }
        
        // Initialize on load
        window.HVARInitializeCamera = function() {
          console.log('üöÄ Initializing HVAR Camera System...');
          
          // Check for getUserMedia support
          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            console.error('‚ùå getUserMedia not supported');
            
            // Try polyfill
            if (navigator.getUserMedia || navigator.webkitGetUserMedia || 
                navigator.mozGetUserMedia || navigator.msGetUserMedia) {
              console.log('üì± Using legacy getUserMedia polyfill');
              
              navigator.mediaDevices = navigator.mediaDevices || {};
              navigator.mediaDevices.getUserMedia = function(constraints) {
                const getUserMedia = navigator.getUserMedia || 
                                   navigator.webkitGetUserMedia || 
                                   navigator.mozGetUserMedia || 
                                   navigator.msGetUserMedia;
                
                return new Promise((resolve, reject) => {
                  getUserMedia.call(navigator, constraints, resolve, reject);
                });
              };
            } else {
              window.HVARCameraState.error = new Error('Camera not supported on this device');
              return false;
            }
          }
          
          // Pre-load camera permissions if secure context
          if (location.protocol === 'https:' || location.hostname === 'localhost') {
            console.log('üîí Secure context detected, pre-checking permissions...');
            
            // Check permissions API
            if (navigator.permissions) {
              navigator.permissions.query({ name: 'camera' }).then(result => {
                console.log('üìã Camera permission status:', result.state);
                
                if (result.state === 'granted') {
                  window.HVARCameraState.hasPermission = true;
                }
                
                result.addEventListener('change', () => {
                  console.log('üìã Camera permission changed to:', result.state);
                  window.HVARCameraState.hasPermission = result.state === 'granted';
                });
              }).catch(e => {
                console.warn('‚ö†Ô∏è Permissions API not fully supported:', e);
              });
            }
          } else {
            console.warn('‚ö†Ô∏è Not in secure context, camera may not work properly');
          }
          
          window.HVARCameraState.isInitialized = true;
          console.log('‚úÖ HVAR Camera System initialized!');
          return true;
        };
        
        // Auto-initialize when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', window.HVARInitializeCamera);
        } else {
          window.HVARInitializeCamera();
        }
        
        // Global error handler for camera issues
        window.addEventListener('unhandledrejection', function(event) {
          if (event.reason && event.reason.name && 
              (event.reason.name.includes('NotAllowed') || 
               event.reason.name.includes('Permission') ||
               event.reason.name.includes('NotFound'))) {
            console.error('üö® Camera permission error caught globally:', event.reason);
            window.HVARCameraState.error = event.reason;
          }
        });
        
        console.log('üéâ HVAR Camera Masterpiece loaded! Ready for ANY device! üéâ');
        
      })();
    </script>

  </head>
  <body class="font-cairo" dir="rtl">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- ENHANCED CAMERA FEATURES & PWA INTEGRATION -->
    <script>
      // üöÄ Enhanced Camera Features for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
              
              // Register for camera permission events
              if (registration.active) {
                registration.active.postMessage({
                  type: 'CAMERA_PERMISSION_READY',
                  cameraState: window.HVARCameraState || {}
                });
              }
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
      
      // üì± PWA Install Handler with Camera Permission
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('üî• PWA install prompt available');
        e.preventDefault();
        deferredPrompt = e;
        
        // Auto-trigger camera permission when PWA is installable
        if (window.HVARRequestCameraPermission) {
          setTimeout(() => {
            console.log('üé¨ Auto-requesting camera permission for PWA...');
            window.HVARRequestCameraPermission().then(result => {
              console.log('üé¨ PWA camera permission result:', result);
            }).catch(e => {
              console.warn('‚ö†Ô∏è PWA camera permission failed:', e);
            });
          }, 2000);
        }
      });
      
      // üîÑ Visibility Change Handler for Camera
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible' && window.HVARCameraState) {
          console.log('üì± App became visible, checking camera state...');
          
          // Re-check camera permission when app becomes visible
          if (navigator.permissions && window.HVARCameraState.isInitialized) {
            navigator.permissions.query({ name: 'camera' }).then(result => {
              console.log('üìã Camera permission re-check:', result.state);
              window.HVARCameraState.hasPermission = result.state === 'granted';
            }).catch(e => {
              console.warn('‚ö†Ô∏è Permission re-check failed:', e);
            });
          }
        }
      });
      
      // üéØ Orientation Change Handler
      window.addEventListener('orientationchange', () => {
        console.log('üì± Orientation changed, adjusting camera...');
        setTimeout(() => {
          if (window.HVARCameraState && window.HVARCameraState.stream) {
            // Refresh camera stream after orientation change
            const tracks = window.HVARCameraState.stream.getVideoTracks();
            tracks.forEach(track => {
              if (track.getSettings) {
                const settings = track.getSettings();
                console.log('üìπ Current camera settings:', settings);
              }
            });
          }
        }, 500);
      });
      
      // üö® Network Status Handler
      window.addEventListener('online', () => {
        console.log('üåê Network back online');
        if (window.HVARCameraState && !window.HVARCameraState.hasPermission) {
          console.log('üîÑ Retrying camera permission after network restoration...');
          setTimeout(() => {
            if (window.HVARRequestCameraPermission) {
              window.HVARRequestCameraPermission();
            }
          }, 1000);
        }
      });
      
      // üíæ Storage Quota Check for Camera Data
      if ('storage' in navigator && 'estimate' in navigator.storage) {
        navigator.storage.estimate().then(estimate => {
          const usage = estimate.usage;
          const quota = estimate.quota;
          const usagePercentage = (usage / quota) * 100;
          
          console.log(`üíæ Storage usage: ${usagePercentage.toFixed(2)}% (${usage} / ${quota} bytes)`);
          
          if (usagePercentage > 80) {
            console.warn('‚ö†Ô∏è Storage quota running low, camera performance may be affected');
          }
        });
      }
      
      // üé™ Global Camera Helper Functions
      window.HVARGetCameraInfo = function() {
        return {
          state: window.HVARCameraState,
          isSupported: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
          isSecureContext: window.isSecureContext,
          permissions: 'permissions' in navigator,
          deviceMemory: navigator.deviceMemory || 'unknown',
          hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
          connectionType: navigator.connection ? navigator.connection.effectiveType : 'unknown'
        };
      };
      
      window.HVARStopCamera = function() {
        if (window.HVARCameraState && window.HVARCameraState.stream) {
          const tracks = window.HVARCameraState.stream.getTracks();
          tracks.forEach(track => track.stop());
          window.HVARCameraState.stream = null;
          window.HVARCameraState.hasPermission = false;
          console.log('üìπ Camera stopped and permissions reset');
        }
      };
      
      console.log('üéâ Enhanced Camera Features loaded!');
    </script>
  </body>
</html>